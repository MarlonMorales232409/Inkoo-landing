---
const faqs = [
  {
    category: "Sobre Tiempos y Envíos",
    items: [
      {
        question: "¿Cuánto tardáis en entregar un pedido?",
        answer:
          "Para pedidos estándar, el plazo es de 3 a 5 días laborables. Sin embargo, somos especialistas en urgencias: si tienes un evento o una necesidad inmediata, ofrecemos un **Servicio Exprés de 24/48h**. Al ser un taller local con stock propio, no dependemos de terceros.",
      },
      {
        question: "¿Hacéis envíos o puedo recoger el pedido?",
        answer:
          "Enviamos a toda España peninsular. Si estás en nuestra zona (**Blanes y alrededores**), puedes pasar a recogerlo gratuitamente por nuestro taller o incluso podemos acercártelo nosotros mismos si es un pedido de volumen.",
      },
    ],
  },
  {
    category: "Sobre Calidad y Garantía",
    items: [
      {
        question: "¿Se va a despegar el logo con los lavados?",
        answer:
          "**No**. Usamos sublimación (la tinta se funde con la tela) para camisetas deportivas, lo que hace que el diseño sea imborrable. Para algodón y ropa laboral, utilizamos vinilo textil profesional de alta resistencia. Además, ofrecemos una **garantía de reposición de 3 meses**: si se despega con un uso normal, te hacemos una nueva gratis.",
      },
      {
        question: "¿Qué tipo de camisetas usáis para gimnasios?",
        answer:
          "Para deporte utilizamos exclusivamente tejido técnico de poliéster con **'Tacto Seda'**. A diferencia de las camisetas técnicas baratas que pican o pesan, estas son ultra ligeras, transpirables y muy suaves al contacto con la piel. Tus clientes o entrenadores notarán la diferencia.",
      },
    ],
  },
  {
    category: "Sobre el Diseño y Pedidos",
    items: [
      {
        question:
          "No tengo el logo en formato vectorial, ¿sirve una imagen normal?",
        answer:
          "**Sí, no te preocupes**. Mándanos lo que tengas (JPG, PNG o incluso una foto de tu tarjeta de visita). Nuestro equipo se encarga de adaptarlo y vectorizarlo para que quede nítido en la camiseta **sin coste extra** en la mayoría de los casos.",
      },
      {
        question: "¿Puedo ver cómo quedará antes de pagar?",
        answer:
          "**Siempre**. Antes de poner ni una sola camiseta en la plancha, te enviaremos un **mockup digital** (montaje) por WhatsApp para que veas exactamente cómo quedará el tamaño y la posición. No imprimimos nada hasta que nos des tu 'OK'.",
      },
      {
        question: "¿Hay un pedido mínimo?",
        answer:
          "Estamos enfocados a empresas y grupos, por lo que nuestros precios más competitivos son a partir de **10 unidades** (Packs). Sin embargo, si necesitas una muestra inicial para ver la calidad antes de hacer un pedido grande, contáctanos y lo gestionamos.",
      },
    ],
  },
];

// Generate structured data for SEO
const faqStructuredData = {
  "@context": "https://schema.org",
  "@type": "FAQPage",
  "mainEntity": faqs.flatMap(category => 
    category.items.map(item => ({
      "@type": "Question",
      "name": item.question,
      "acceptedAnswer": {
        "@type": "Answer",
        "text": item.answer.replace(/\*\*/g, '')
      }
    }))
  )
};
---

<section id="faq" class="w-full bg-white py-20" itemscope itemtype="https://schema.org/FAQPage">
  <div class="max-w-4xl mx-auto px-4 sm:px-6 lg:px-8">
    <!-- Section Header -->
    <div class="text-center mb-16" data-aos="fade-up">
      <h2 class="text-4xl md:text-5xl font-heading font-medium text-inkoo-black mb-4">
        Preguntas <span class="text-inkoo-magenta">Frecuentes</span>
      </h2>
      <p class="text-gray-600 text-lg max-w-2xl mx-auto">
        Resuelve tus dudas sobre nuestros servicios de sublimación y personalización textil
      </p>
    </div>

    <!-- FAQ Categories -->
    <div class="space-y-16">
      {faqs.map((category, categoryIndex) => (
        <div class="faq-category" data-aos="fade-up" data-aos-delay={categoryIndex * 100}>
          <!-- Category Title -->
          <h3 class="text-2xl font-heading font-medium text-inkoo-black mb-8 flex items-center gap-3">
            <span class="w-1 h-8 bg-inkoo-magenta rounded-full"></span>
            {category.category}
          </h3>

          <!-- FAQ Items -->
          <div class="faq-items-container">
            {category.items.map((item, itemIndex) => (
              <div 
                class="faq-item"
                itemscope 
                itemprop="mainEntity" 
                itemtype="https://schema.org/Question"
              >
                <button
                  type="button"
                  class="faq-question w-full text-left py-6 transition-all duration-200"
                  aria-expanded="false"
                  aria-controls={`faq-answer-${categoryIndex}-${itemIndex}`}
                  id={`faq-question-${categoryIndex}-${itemIndex}`}
                >
                  <div class="flex items-center justify-between gap-6">
                    <span class="font-medium text-inkoo-black text-lg" itemprop="name">
                      {item.question}
                    </span>
                    <svg 
                      class="faq-icon-down w-5 h-5 text-gray-400 flex-shrink-0 transition-all duration-200"
                      xmlns="http://www.w3.org/2000/svg" 
                      fill="none" 
                      viewBox="0 0 24 24" 
                      stroke="currentColor"
                      stroke-width="2"
                      aria-hidden="true"
                    >
                      <path stroke-linecap="round" stroke-linejoin="round" d="M19 9l-7 7-7-7" />
                    </svg>
                    <svg 
                      class="faq-icon-up w-5 h-5 text-inkoo-magenta flex-shrink-0 transition-all duration-200 opacity-0"
                      xmlns="http://www.w3.org/2000/svg" 
                      fill="none" 
                      viewBox="0 0 24 24" 
                      stroke="currentColor"
                      stroke-width="2"
                      aria-hidden="true"
                    >
                      <path stroke-linecap="round" stroke-linejoin="round" d="M5 15l7-7 7 7" />
                    </svg>
                  </div>
                </button>

                <div
                  class="faq-answer"
                  id={`faq-answer-${categoryIndex}-${itemIndex}`}
                  role="region"
                  aria-labelledby={`faq-question-${categoryIndex}-${itemIndex}`}
                  itemscope 
                  itemprop="acceptedAnswer" 
                  itemtype="https://schema.org/Answer"
                >
                  <div class="faq-answer-content">
                    <p class="text-gray-600 leading-relaxed" itemprop="text" set:html={item.answer.replace(/\*\*(.*?)\*\*/g, '<strong class="text-inkoo-black font-semibold">$1</strong>')} />
                  </div>
                </div>
              </div>
            ))}
          </div>
        </div>
      ))}
    </div>

    <!-- CTA Footer -->
    <div class="mt-16 text-center" data-aos="fade-up">
      <p class="text-gray-600 mb-6">
        ¿No encuentras la respuesta que buscas?
      </p>
      <a
        href="#contacto"
        class="inline-flex items-center justify-center px-8 py-4 bg-inkoo-magenta text-white font-medium rounded-full hover:bg-inkoo-magenta/90 transition-all duration-200 shadow-lg hover:shadow-xl hover:scale-105"
      >
        Contáctanos directamente
      </a>
    </div>
  </div>

  <!-- Structured Data for SEO -->
  <script type="application/ld+json" set:html={JSON.stringify(faqStructuredData)} />
</section>

<style>
  /* FAQ Items Container - Clean separator lines */
  .faq-items-container {
    border-top: 1px solid #e5e7eb;
  }

  .faq-item {
    border-bottom: 1px solid #e5e7eb;
    contain: layout style;
    transform: translateZ(0);
  }

  /* FAQ Question Button */
  .faq-question {
    -webkit-tap-highlight-color: transparent;
    position: relative;
  }

  .faq-question:hover {
    color: #0a0a0a;
  }

  .faq-question:hover .faq-icon-down {
    color: #2491cf;
  }

  /* Arrow Icons - Positioned absolutely to overlap */
  .faq-question > div {
    position: relative;
  }

  .faq-icon-down,
  .faq-icon-up {
    position: absolute;
    right: 0;
    transition: opacity 180ms cubic-bezier(0, 0, 0, 1);
  }

  .faq-icon-down {
    opacity: 1;
  }

  .faq-icon-up {
    opacity: 0;
  }

  /* Active state - swap arrows */
  .faq-item.active .faq-icon-down {
    opacity: 0;
  }

  .faq-item.active .faq-icon-up {
    opacity: 1;
  }

  /* FAQ Answer - Instant & Smooth Accordion */
  .faq-answer {
    display: grid;
    grid-template-rows: 0fr;
    transition: grid-template-rows 200ms cubic-bezier(0, 0, 0, 1);
    overflow: hidden;
    will-change: grid-template-rows;
  }

  .faq-answer-content {
    min-height: 0;
    padding: 0 0;
    opacity: 0;
    transition: opacity 180ms ease-out;
  }

  /* Expanded State */
  .faq-item.active .faq-answer {
    grid-template-rows: 1fr;
  }

  .faq-item.active .faq-answer-content {
    padding-bottom: 1.5rem;
    opacity: 1;
  }

  /* Focus styles for accessibility */
  .faq-question:focus-visible {
    outline: 2px solid #2491cf;
    outline-offset: 2px;
  }
</style>

<script>
  // FAQ Accordion functionality
  function initFAQ() {
    const faqItems = document.querySelectorAll('.faq-item');

    faqItems.forEach((item) => {
      const button = item.querySelector('.faq-question');
      
      if (!button) return;

      button.addEventListener('click', () => {
        const isActive = item.classList.contains('active');
        
        // Close all other items
        faqItems.forEach(otherItem => {
          if (otherItem !== item) {
            otherItem.classList.remove('active');
            const otherButton = otherItem.querySelector('.faq-question');
            if (otherButton) otherButton.setAttribute('aria-expanded', 'false');
          }
        });

        // Toggle current item
        item.classList.toggle('active');
        button.setAttribute('aria-expanded', !isActive ? 'true' : 'false');
      });

      // Keyboard accessibility
      button.addEventListener('keydown', (e) => {
        if (e instanceof KeyboardEvent && (e.key === 'Enter' || e.key === ' ')) {
          e.preventDefault();
          (button as HTMLButtonElement).click();
        }
      });
    });
  }

  // Initialize on page load
  if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', initFAQ);
  } else {
    initFAQ();
  }

  // Re-initialize after view transitions (Astro)
  document.addEventListener('astro:page-load', initFAQ);
</script>
